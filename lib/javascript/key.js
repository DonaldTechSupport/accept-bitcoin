// Generated by CoffeeScript 1.6.3
(function() {
  var Key, bitcore, crypt, fs,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  bitcore = require('bitcore');

  crypt = require('./encrypt');

  fs = require('fs');

  Key = (function() {
    function Key(settings, publicKey, privateKeyHex) {
      this.settings = settings;
      this.publicKey = publicKey;
      this.privateKeyHex = privateKeyHex;
      this.readKeys = __bind(this.readKeys, this);
      this.storeKey = __bind(this.storeKey, this);
      this.printKey = __bind(this.printKey, this);
      this.privateKey = __bind(this.privateKey, this);
      this.address = __bind(this.address, this);
      this.wk = __bind(this.wk, this);
      this.wk = new bitcore.WalletKey({
        network: this.settings.network
      });
      if (this.privateKeyHex) {
        this.wk.fromObj({
          priv: this.privateKeyHex
        });
      }
      if (arguments.length <= 1) {
        this.wk = new bitcore.WalletKey({
          network: this.settings.network
        });
        this.wk.generate();
        this.storeKey();
      }
      this.printKey(this.wk);
    }

    Key.prototype.wk = function() {
      return this.wk;
    };

    Key.prototype.address = function() {
      return this.publicKey || this.wk.storeObj().addr;
    };

    Key.prototype.privateKey = function() {
      return this.privateKeyHex || this.wk.storeObj().priv;
    };

    Key.prototype.printKey = function(wk) {
      var wkObj;
      if (wk == null) {
        wk = this.wk;
      }
      if (this.publicKey && this.privateKeyHex) {
        return console.log("public: " + this.publicKey + " private: " + this.privateKeyHex);
      } else {
        console.log("## Network: " + wk.network.name);
        console.log("*** Hex Representation");
        console.log("Private: " + bitcore.buffertools.toHex(wk.privKey["private"]));
        console.log("Public : " + bitcore.buffertools.toHex(wk.privKey["public"]));
        console.log("Public Compressed : " + (wk.privKey.compressed ? "Yes" : "No"));
        wkObj = wk.storeObj();
        console.log("*** WalletKey Store Object");
        console.log("Private: " + wkObj.priv);
        console.log("Public : " + wkObj.pub);
        return console.log("Addr   : " + wkObj.addr);
      }
    };

    Key.prototype.storeKey = function(wk) {
      var privateKey, wkObj;
      if (wk == null) {
        wk = this.wk;
      }
      wkObj = wk.storeObj();
      privateKey = this.settings.encryptPrivateKey ? crypt.encrypt(this.privateKey(), this.settings.password) : this.privateKey();
      return fs.appendFileSync(this.settings.storePath, this.address() + "|" + privateKey + "\n");
    };

    Key.prototype.readKeys = function() {
      var lines;
      lines = fs.readFileSync(this.settings.storePath).toString().split("\n");
      return console.log(lines);
    };

    return Key;

  })();

  module.exports = Key;

}).call(this);
